<!-- SIDEBAR - barra lateral minimalista, solo con boton de toggle-->
<div
    class="sidebar-base"
    [class.sidebar-expanded]="!isSidebarCollapsed"
    [class.sidebar-collapsed]="isSidebarCollapsed"
>
    <div class="sidebar-menu">
        <div class="sidebar-title" *ngIf="!isSidebarCollapsed">Crear Preguntas</div>
        <div class="sidebar-item" (click)="onAgregarPregunta()">
            <i class="material-icons sidebar-icon" [class.sidebar-icon-expanded]="!isSidebarCollapsed" [class.sidebar-icon-collapsed]="isSidebarCollapsed">add</i>
            <span class="sidebar-text" [class.sidebar-text-visible]="!isSidebarCollapsed" [class.sidebar-text-hidden]="isSidebarCollapsed">Nueva pregunta</span>
        </div>

        <!-- Lista de preguntas guardadas -->
        <div class="sidebar-title" *ngIf="!isSidebarCollapsed && questionnaireQuestions.length > 0">Preguntas guardadas</div>
        <div class="sidebar-item saved-question" *ngFor="let question of questionnaireQuestions"[class.active-parent]="activeQuestionDropdown === question.id">
            <!-- contenedor principal clickeable para editar -->
             <div class="question-content" (click)="editQuestion(question)">
                <i class="material-icons sidebar-icon" [class.sidebar-icon-expanded]="!isSidebarCollapsed" [class.sidebar-icon-collapsed]="isSidebarCollapsed">
                    {{ question.question_type === 'multiple' ? 'checklist' : 'chat_bubble_outline' }}
                </i>
                <span class="sidebar-text" [class.sidebar-text-visible]="!isSidebarCollapsed" [class.sidebar-text-hidden]="isSidebarCollapsed">
                    {{ question.text | slice:0:20 }}{{ question.text.length > 20 ? '...' : '' }}
                </span>
             </div>

             <!-- boton de mas opciones -->
              <div class="question-menu-container" *ngIf="!isSidebarCollapsed">
                <button class="question-menu-btn" (click)="toggleQuestionDropdown(question.id, $event)">
                    <i class="material-icons">more_vert</i>
                </button>

                <!-- dropdown de opciones -->
                 <div class="question-dropdown" [class.show]="activeQuestionDropdown === question.id">
                    <div class="question-dropdown-item" (click)="duplicateQuestion(question); $event.stopPropagation()">
                        <i class="material-icons">content_copy</i>
                        <span>Duplicar</span>
                    </div>
                    <div class="question-dropdown-item delete-item" (click)="deleteQuestionFromSidebar(question); $event.stopPropagation()">
                        <i class="material-icons">delete</i>
                        <span>Eliminar</span>
                    </div>
                 </div>
              </div>
        </div>

        <!-- Mensaje cuando no hay preguntas -->
        <div class="sidebar-item no-questions" *ngIf="questionnaireQuestions.length === 0 && !isSidebarCollapsed">
            <i class="material-icons sidebar-icon">info</i>
            <span class="sidebar-text">No hay preguntas guardadas</span>
        </div>
    </div>
</div>

<!-- BOTON DE COLAPSAR/EXPANDIR con animacion de rotacion-->
 <div
    (click)="toggleSidebar()"
    class="chevron-button"
    [class.chevron-expanded]="!isSidebarCollapsed"
    [class.chevron-collapsed]="isSidebarCollapsed"
>
<!-- icono de chevrones -->
  <svg style="width: 100%; height: 100%;" fill="none" preserveAspectRatio="none" viewBox="0 0 24 24">
    <path d="M15 18L9 12L15 6" stroke="#F3F3F3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</div>

<!-- contenido principal -->
<div
    class="transition-all duration-400"
    [class.content-expanded]="!isSidebarCollapsed"
    [class.content-collapsed]="isSidebarCollapsed"
>

    <div class="crear-container">
        <!-- Vista del cuestionario -->
        <div *ngIf="currentView === 'cuestionario'" class="multiple-choice-form">
            <div class="config-container">
                <div class="header">
                    <div class="title-group">
                        <i class="material-icons">assignment</i>
                        <span>Cuestionario</span>
                    </div>
                    <div class="header-actions">
                        <div class="delete-icon" (click)="deleteQuestionnaire()">
                            <i class="material-icons">delete_outline</i>
                        </div>
                    </div>
                </div>

                <div class="content">
                    <input
                        type="text"
                        class="question-input"
                        placeholder="Nombre del cuestionario..."
                        [(ngModel)]="questionnaireTitle">

                    <!-- Estado vacío -->
                    <div class="empty-state" *ngIf="showEmptyState" id="emptyState">
                        <p class="text-muted mb-4">El cuestionario está vacío</p>
                        <button class="btn-add-first" (click)="seleccionarTipo('questionnaire')">
                            <i class="material-icons">add</i>
                            <span>Añadir pregunta al cuestionario</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vista de opciones de preguntas -->
        <div *ngIf="currentView === 'options'" class="interaction-grid" [class.animate-cards]="animateCards">

            <!-- Opción múltiple -->
            <div class="interaction-card" (click)="seleccionarTipo('multiple')">
            <div class="card-icon blue">
                <i class="material-icons">checklist</i>
            </div>
            <h3>Opción múltiple</h3>
            </div>

            <!-- Abrir texto -->
            <div class="interaction-card" (click)="seleccionarTipo('abierta')">
            <div class="card-icon teal">
                <i class="material-icons">chat_bubble_outline</i>
            </div>
            <h3>Abrir texto</h3>
            </div>

            <!-- Cuestionario -->
            <div class="interaction-card" (click)="seleccionarTipo('cuestionario')">
            <div class="card-icon orange">
                <i class="material-icons">assignment</i>
            </div>
            <h3>Cuestionario</h3>
            </div>

        </div>

        <!-- Vista del formulario de pregunta múltiple -->
        <div *ngIf="currentView === 'form'" class="multiple-choice-form">
            <div class="config-container">
                <div class="header">
                    <div class="title-group" *ngIf="selectedQuestionType !== 'questionnaire'">
                        <div class="dropdown-container">
                            <div class="dropdown-trigger-area" (click)="toggleDropdown()">
                                <i class="material-icons">{{ currentQuestionTypeConfig.icon}}</i>
                                <span>{{ currentQuestionTypeConfig.name }}</span>
                                <i class="material-icons">keyboard_arrow_down</i>
                            </div>
                            <div class="dropdown-menu" [class.show]="showDropdown">

                                <div class="dropdown-option" (click)="selectQuestionType('multiple')">Opción múltiple</div>
                                <div class="dropdown-option" (click)="selectQuestionType('abierta')">Pregunta abierta</div>

                            </div>
                        </div>
                    </div>

                    <div class="title-group" *ngIf="selectedQuestionType === 'questionnaire'">
                        <i class="material-icons">assignment</i>
                        <span>Pregunta del cuestionario</span>
                    </div>

                    <div class="header-actions">
                        <button class="save-btn" (click)="saveQuestionnaire()">
                            {{ isEditing ? 'Actualizar Pregunta' : 'Guardar Pregunta' }}
                        </button>
                        <div class="delete-icon" (click)="deleteQuestion()">
                            <i class="material-icons">delete_outline</i>
                        </div>
                        <div class="config-icon" (click)="toggleConfigSidebar(); $event.stopPropagation()">
                            <i class="material-icons">settings</i>
                            <span>Configuración de pregunta</span>
                        </div>
                    </div>
                </div>

                <!-- selector de temporizador para preguntas de cuestionario -->
                <div class="timer-dropdown-container" *ngIf="selectedQuestionType === 'questionnaire'">
                    <div class="timer-trigger-area" (click)="toggleTimerDropdown()">
                        <span class="timer-display">{{ getTimerDisplayText() }}</span>
                        <i class="material-icons">keyboard_arrow_down</i>
                    </div>
                    <div class="timer-dropdown-menu" [class.show]="showTimerDropdown">
                        <div class="timer-option" (click)="selectTimer(0)">Sin temporizador</div>
                        <div class="timer-option" (click)="selectTimer(10)">10 segundos</div>
                        <div class="timer-option" (click)="selectTimer(20)">20 segundos</div>
                        <div class="timer-option" (click)="selectTimer(30)">30 segundos</div>
                        <div class="timer-option" (click)="selectTimer(60)">1 minuto</div>
                        <div class="timer-option" (click)="selectTimer(120)">2 minutos</div>
                        <div class="timer-option" (click)="selectTimer(180)">3 minutos</div>
                    </div>
                </div>

                <div class="content">
                    <input
                        type="text"
                        class="question-input"
                        placeholder="¿Qué desea preguntar?"
                        [(ngModel)]="questionText"
                        autofocus>

                    <!-- campo de descripcion de la pregunta -->
                     <div *ngIf="showQuestionDescription" class="question-description-container">
                        <textarea
                            class="question-description-input"
                            placeholder="Escribe una descripción adicional para la pregunta..."
                            [(ngModel)]="questionDescription"
                            rows="3"></textarea>
                     </div>

                    <!-- mensaje cuando selecciona la respuesta correcta (solo para preguntas múltiples) -->
                     <div *ngIf="selectedQuestionType === 'multiple' && showCorrectAnswer && !hasCorrectAnswers" class="correct-answer-info">
                        <i class="material-icons">info</i>
                        <p>No olvide marcar la respuesta correcta</p>
                     </div>

                    <!-- Formulario para opción múltiple -->
                    <div *ngIf="selectedQuestionType === 'multiple'">
                        <div class="options-list">
                            <div class="option-row" *ngFor="let option of options; let i = index; trackBy: trackByIndex">
                                <input
                                    type="text"
                                    class="option-input"
                                    [placeholder]="'Opción ' + (i + 1)"
                                    [(ngModel)]="option.text">
                                    
                                <!-- icono de respuesta correcta -->
                                 <span
                                    *ngIf="showCorrectAnswer"
                                    class="material-icons correct-answer-icon"
                                    [class.correct-selected]="option.isCorrect"
                                    (click)="toggleCorrectOption(i)">
                                    check_circle_outline
                                 </span>
                                 
                                <span class="material-icons delete-option" (click)="removeOption(i)">close</span>
                            </div>
                        </div>

                        <div class="add-option" (click)="addOption()">
                            <i class="material-icons">add</i>
                            <span>Añadir opción</span>
                        </div>
                    </div>

                    <div *ngIf="selectedQuestionType === 'questionnaire'">
                        <div class="options-list">
                            <div class="option-row" *ngFor="let option of options; let i = index; trackBy: trackByIndex">
                                <input
                                    type="text"
                                    class="option-input"
                                    [placeholder]="'Opción ' + (i + 1)"
                                    [(ngModel)]="option.text">
                                
                                <!-- icono de respuesta correcta -->
                                 <span
                                    *ngIf="showCorrectAnswer"
                                    class="material-icons correct-answer-icon"
                                    [class.correct-selected]="option.isCorrect"
                                    (click)="toggleCorrectOption(i)">
                                    check_circle_outline
                                 </span>

                                 <span class="material-icons delete-option" (click)="removeOption(i)">close</span>

                            </div>
                        </div>

                        <div class="add-option" (click)="addOption()">
                            <i class="material-icons">add</i>
                            <span>Añadir opción</span>
                        </div>

                        <!-- Boton para añadir otra pregunta de cuestionario -->
                        <div class="add-questionnaire-btn-container">
                            <button class="add-questionnaire-btn" (click)="addAnotherQuestionnaireQuestion()">
                                <i class="material-icons">add</i>
                                <span>Añadir otra pregunta de cuestionario</span>
                            </button>
                        </div>
                    </div>

                    <!-- Formulario para pregunta abierta -->
                    <div *ngIf="selectedQuestionType === 'abierta'" class="open-question-form">
                        <textarea
                            class="open-question-textarea"
                            placeholder="El estudiante podrá escribir su respuesta aquí..."
                            readonly></textarea>
                    </div>


                </div>
            </div>
        </div>
    </div>

    <!-- sidebar derecho de configuracio -->
    <div class="config-sidebar" [class.open]="showConfigSidebar">
        <div class="config-sidebar-header">
            <div class="config-sidebar-title">
                <span>Configuración de pregunta</span>
            </div>
            <div class="config-sidebar-close" (click)="toggleConfigSidebar()">
                <span>Cerrar</span>
                <i class="material-icons">cancel</i>
            </div>
        </div>
        <div class="config-sidebar-content">
            <div class="config-option">
                <!-- Opciones para preguntas múltiples -->
                <div *ngIf="selectedQuestionType === 'multiple' || selectedQuestionType === 'questionnaire'">
                    <button class="toggle-button" (click)="toggleMultipleOptions()">
                        <span class="toggle-text">Varias opciones</span>
                        <i class="material-icons toggle-icon" [ngClass]="{'toggle-on': allowMultipleOptions, 'toggle-off': !allowMultipleOptions}">
                            {{ allowMultipleOptions ? 'toggle_on' : 'toggle_off' }}
                        </i>
                    </button>
                    <p class="option-description">
                        Los participantes pueden seleccionar más de una opción
                    </p>
                    <!-- Sección adicional cuando varias opciones está activado -->
                    <div *ngIf="allowMultipleOptions" class="max-options-config">
                        <div class="max-options-row">
                            <span class="max-options-text">
                                Los participantes pueden seleccionar hasta:
                            </span>
                            <div class="max-options-controls">
                                <button class="control-btn" (click)="decreaseMaxOptions()">
                                    <i class="material-icons">do_not_disturb_on</i>
                                </button>
                                <span class="max-options-number">{{ maxSelectableOptions }}</span>
                                <button class="control-btn" (click)="increaseMaxOptions()">
                                    <i class="material-icons">add_circle</i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <button class="toggle-button" (click)="toggleCorrectAnswer()">
                        <span class="toggle-text">Marque la respuesta correcta</span>
                        <i class="material-icons toggle-icon" [ngClass]="{'toggle-on': showCorrectAnswer, 'toggle-off': !showCorrectAnswer}">
                            {{ showCorrectAnswer ? 'toggle_on' : 'toggle_off' }}
                        </i>
                    </button>
                    <p class="option-description">
                        Seleccione y muestre la respuesta correcta para los participantes
                    </p>
                </div>

                <!-- Opción común para todas las preguntas: Descripción -->
                <button class="toggle-button" (click)="toggleQuestionDescription()">
                    <span class="toggle-text"> Descripción  de la pregunta</span>
                    <i class="material-icons toggle-icon" [ngClass]="{'toggle-on': showQuestionDescription, 'toggle-off': !showQuestionDescription}">
                        {{ showQuestionDescription ? 'toggle_on' : 'toggle_off'}}
                    </i>
                </button>
                <p class="option-description">
                    Agregar una descripción visible para los participantes
                </p>

                <!-- Opción específica para preguntas de cuestionario: Temporizador -->
                <div *ngIf="selectedQuestionType === 'questionnaire'">
                    <button class="toggle-button" (click)="toggleQuestionTimer()">
                        <span class="toggle-text">Añadir temporizador de preguntas</span>
                        <i class="material-icons toggle-icon" [ngClass]="{'toggle-on': showQuestionTimer, 'toggle-off': !showQuestionTimer}">
                            {{ showQuestionTimer ? 'toggle_on' : 'toggle_off' }}
                        </i>
                    </button>
                    <p class="option-description">
                        Establecer un límite de tiempo para responder a la pregunta
                    </p>
                </div>
            </div>
        </div>
    </div>
    <!-- overlay para cerrar el sidebar haciendo click afuera -->
     <div class="config-sidebar-overlay"
     [class.active]="showConfigSidebar"
     (click)="toggleConfigSidebar()"></div>
